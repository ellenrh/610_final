---
title             : "What explains happiness? The relationships between happiness and marrige, religion health, trust, and                        saving"
shorttitle        : "What explains happiness?"

author: 
  - name          : "Asha Yadav"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"
  - name          : "Joanna"
    affiliation   : "1"
    corresponding : no    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"
  - name          : "Thuy"
    affiliation   : "1"
    corresponding : no    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"

affiliation:
  - id            : "1"
    institution   : "University of Oregon"

authornote: |
  We thank Dr. Nese for his guidance in this project. All mistakes remain ours. 

abstract: |
  abstract goes here
  
keywords          : "happiness"
wordcount         : "X"

bibliography      : [r-references.bib]

floatsintext      : yes
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(warning = FALSE,
                      echo = FALSE
                      )
library("papaja")
library(tidyverse)
library(rio)
library(here)
library(janitor)
library(dplyr)
library(kableExtra)
library(knitr)

```

```{r APA table, results= 'asis'}

```

```{r loading the data}

data <- import(here("data","F00007762-WV6_Data_R_v20180912.rds")) %>%
  janitor::clean_names() %>%
  select("v10", "v11", "v24", "v25", "v57", "v147", "v237", "v240") %>% 
  characterize()

```

```{r renaming variable names}

data <- data %>%
  as_tibble() %>%
    rename(
      feeling_of_happiness = v10, 
      state_of_health = v11, 
      most_people_trusted = v24,
      member_religion = v25,
      marital_status = v57,
      religious_person = v147,
      family_savings = v237,
      gender = v240)

```


```{r cleaning the data: recoding levels}

unique(data$feeling_of_happiness)

data <- data %>%
    mutate(feeling_of_happiness = fct_recode(feeling_of_happiness,
                          "Very happy" = "Very happy",
                          "Rather happy" = "Rather happy",
                          "Not very happy" = "Not very happy",
                          "Not at all happy" = "Not at all happy",
                          "Other" = "No answer",
                          "Other" = "Dont know", 
                          "Other" = "HT: Missing-Dropped out survey; RU: Inappropriate response{Inappropriate}"))


data <- data %>%
  mutate(state_of_health = fct_recode(state_of_health,
                          "Very good" = "Very good",
                          "Other" = "No answer",
                          "Other" = "Dont know", 
                          "Other" = "HT: Missing-Dropped out survey; RU: Inappropriate response{Inappropriate}"),
         state_of_health = fct_recode(state_of_health,
         "Very good" = "Very good",
                          "Good" = "Good",
                          "Fair" = "Fair",
                          "Poor" = "Poor",
                          "Other" = "No answer",
                          "Other" = "Dont know", 
                          "Other" = "BH:Missing;HT:Missing-Dropped out survey; RU:Inappropriate response{Inappropriate}")) 
  
data <- data %>%
  mutate(most_people_trusted = fct_recode(most_people_trusted, 
                          "Most people can be trusted" = "Most people can be trusted",
                          "Need to be very careful" = "Need to be very careful",
                          "Other" = "DE,SE: Inapplicable;RU: Inappropiate response;SG:Missing;HT: Dropped out survey{Inappropriate}",
                          "Other" = "No answer",
                          "Other" = "Dont know"))

data <- data %>%
  mutate(member_religion = fct_recode(member_religion, 
                        "Not a member" = "Not a member",
                        "Inactive member" = "Inactive member",
                        "Active member" = "Active member",
                        "Other" =  "HT: Dropped out survey;SE: Inapplicable;RU: Inappropriate response{Inappropriate}",
                        "Other" = "No answer",
                        "Other" = "Dont know"))

data <- data %>%
  mutate(marital_status = fct_recode(marital_status, 
                          "Married" = "Married",
                          "Living together as married" = "Living together as married",
                          "Divorced" = "Divorced",
                          "Separated" = "Separated",
                          "Widowed" = "Widowed",
                          "Single" = "Single",
                          "Other" = "HT: Dropped out survey;SG: Missing; RU: Inappropriate response{Inappropriate}",
                          "Other" = "No answer",
                          "Other" = "Dont know"))

data <- data %>%
  mutate(religious_person = fct_recode(religious_person, 
                           "A religious person" = "A religious person",
                           "Not a religious person" = "Not a religious person",
                           "Not a religious person" = "An atheist",
                           "Other" = "No answer",
                           "Other" = "Dont know",
                           "Other" = "Not asked in survey",
                           "Other" = "DE,SE:Inapplicable ; RU:Inappropriate response; HT: Dropped out survey{Inappropriate}"))

data <- data %>%
mutate(family_savings = fct_recode(family_savings, 
                           "Save money" = "Save money", 
                           "Just get by" = "Just get by", 
                           "Spent savings and borrowed money" = "Spent savings and borrowed money",
                           "Spent some savings and borrowed money" = "Spent some savings and borrowed money",
                           "Other" = "No answer",
                           "Other" = "Dont know", 
                           "Other" = "DE,SE:Inapplicable ; RU:Inappropriate response; BH: Missing; HT: Dropped out survey{Inappropriate}", 
                           "Other" = "Not applicable"))

data <- data %>%
  mutate(gender = fct_recode(gender,
                           "Male" = "Male", 
                           "Female" = "Female", 
                           "Other" = "No answer", 
                           "Other" = "Missing; Unknown")) %>% 
  filter(feeling_of_happiness != "Other" &
           state_of_health != "Other" &
           most_people_trusted != "Other" &
           marital_status != "Other" &
           member_religion != "Other" &
           religious_person != "Other" &
           family_savings != "Other" &
           gender != "Other")

# unique(data_1$gender)
# unique(data_1$feeling_of_happiness)
# unique(data_1$marital_status)
# unique(data_1$state_of_health)

```


```{r happiness and family savings JW}

# further tidying the data to use a subset: 

subset_JW <- data %>%
  select(family_savings, feeling_of_happiness)

happiness_by_family_savings <- data %>%
  group_by(family_savings) %>%
  count(feeling_of_happiness)

# making a table: 

kable(happiness_by_family_savings)

# exploring the data with visualizations:

happiness_by_family_savings %>%
  ggplot(aes(feeling_of_happiness, n)) +
  geom_col(fill = "dark blue") +
  facet_wrap(~family_savings) +
  labs(title = "Figure 1", 
       subtitle = "Happiness levels by family savings: Raw numbers",
       x = "Level of happiness",
       y = "Number of people") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# to chart by percentages: 

happiness_by_family_savings <- happiness_by_family_savings %>%
  mutate(total = sum(n)) %>%
  mutate(percent = n/total)

happiness_by_family_savings %>%
  group_by(family_savings) %>%
ggplot(aes(feeling_of_happiness, percent)) +
  geom_col(fill = "dark blue") +
  facet_wrap(~family_savings) +
  labs(title = "Figure 2", 
       subtitle = "Happiness levels by family savings: percentage",
       x = "Level of happiness",
       y = "Percentage of total") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))


# it would be interesting to look at these percentages in order  to compare happiness levels amongst groups:     

happiness_by_family_savings %>%
  as_tibble() %>%
  arrange(percent)

# or, another way to visualize this would be: 

happiness_by_family_savings %>%
  ggplot(aes(feeling_of_happiness, percent, colour = family_savings)) +
  geom_point() +
  geom_smooth(se = FALSE, method = lm) +
  labs(Title = "Figure 3",
       subtitle = "Amother way of looking at happiness by family savings: percentage")
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

As Figure 3 shows, although patterns of happiness levels are similar overall (e.g. most people report being "Rather Happy", fewest people report being "Not happy at all"), there are some differences of happiness level distributions between groups. A greater percentage of those with the lowest level of family savings (those who spent savings and borrowed money) reported being "Not at all happy" or "Not very happy". On the other hand, the greatest percentage of people reporting being "Rather happy" were those who reported just getting by, and the greatest percentage of people reporting the highest level of happiness were those in the strongest financial position - those who saved money.

(NOTE: I'd like to use inline code here to reference exact percentages. How do put one cell value into inline code??)



```{r trying out pivot_wider and pivot_longer}

happiness_by_family_savings_1 <- happiness_by_family_savings%>%
  pivot_wider(
    names_from = family_savings,
    values_from = percent)

happiness_by_family_savings_2 <- happiness_by_family_savings_1 %>%
  pivot_longer(
    cols = c("Save money", "Just get by", "Spent some savings and borrowed money", "Spent savings and borrowed money"), 
    names_to = "family_savings",
    values_to = "percent"
  )

```


```{r health, include= TRUE}

happiness_health <- data %>% 
  select("feeling_of_happiness", "state_of_health") %>%  
  group_by(state_of_health) %>%
  mutate(feeling_of_happiness = fct_relevel(feeling_of_happiness,
                                            "Not at all happy",
                                            "Not very happy",
                                            "Rather happy"
                                            )) %>%
  count(feeling_of_happiness)

happiness_health_wider <-happiness_health %>% 
  pivot_wider(
    names_from = feeling_of_happiness,
    values_from = n) 
  
happiness_health_longer <-happiness_health_wider %>% 
  pivot_longer(
    cols = -1,
    names_to = "level_happy", 
    values_to = "number_of_people"
  )

fig_health <- happiness_health_longer %>% 
ggplot(aes(state_of_health, number_of_people, fill = factor(level_happy)))+
  geom_col(position = "fill", stat = "identity") +
  labs(title = "Feeling of happiness by self-rated state of health",
       x = "Self-rated state of health",
       y = "Feeling of happiness (Percent)",
       caption = "Survey of more than 85,000 respondents across the world. Source: WVS 2012")+
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

```


```{r trust}

trust <- sum(255 + 1528 + 10369 + 6499) 
caution <- sum(1368 + 7619 + 29072 + 19512)
total <- sum(trust + caution)
percent_trust <- (trust/total)*100
percent_caution <- (caution/total)*100

happiness_trust <- data %>% 
  select("feeling_of_happiness", "most_people_trusted") %>%  
  group_by(most_people_trusted) %>% 
  mutate(feeling_of_happiness = fct_relevel(feeling_of_happiness,
                                            "Not at all happy",
                                            "Not very happy",
                                            "Rather happy"
                                            )) %>% 
  count(feeling_of_happiness)

apa_table(happiness_trust)

fig_trust <- happiness_trust %>% 
ggplot(aes(feeling_of_happiness, n))+
  geom_col(color = "red", fill = "lightblue")+
  facet_wrap(~most_people_trusted) +
  labs(title = "Feeling of happiness by trust of people",
       x = "Feeling of happniess",
       y = "Number of people",
       caption = "Survey of more than 85,000 respondents across the world. Source: WVS 2012") +
    theme_minimal() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

```


# Introduction

Study of happiness and its causal factors has been flourished in recent years. Scholars have studied the relationship between happines and political system [@inglehart200911] [add others if you find more...]. This project explores the relationship between happiness and some candidate variables, namely marital status, religious affiliation, level of income, status of heath, and level of trust. We use individual level survey of more than 85,000 respondents across 60 countries and societies around the world in World Value Survey Dataset 2012. 


# Methods
We report how we determined our sample size, all data exclusions (if any), all manipulations, and all measures in the study. <!-- 21-word solution (Simmons, Nelson & Simonsohn, 2012; retrieved from http://ssrn.com/abstract=2160588) -->


## Data analysis

### Happiness and trust

In this section we examine the relationship between happiness and trust. Johnson [-@johnson2012much] finds that "trust as measured by the World Values Survey is positively correlated with experimentally measured trust". 

Out of the total `r total` people, only slightly more than `r percent_trust` percent say they can trust most of the people around them, while `r percent_caution` is caucious about the society. Interstingly, there are more people feel happy in life in the latter group than those in the former. Fingure below indicates such difference. 
```{r}
fig_trust
```


### Happiness and health status

@gandelman2013happiness finds strong relationship between self-rated health status and perceived life quality. In this project, we find similar pattern in the positive correlation between health status and perceived level of happiness. Fingure below clearly indicates that most of people who rated their health status as "good" also felt happy. 
```{r}
fig_health
```

# Results

# Discussion

### Health, trust, and happiness

The data confirms that people with self-rated better state of health feel happier in general. However, on the contrary to the conventional belief that people who feel they can trust people around them should feel more secured, hence happier. The data shows us somewhat the opposite. Those who say they should be careful with the fellows surrounding them indicates higher level of happiness. 


\newpage

# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup

Final Paper

The final project must:

(a) be a reproducible and dynamic APA manuscript produced with R Markdown, via
the {papaja} package and include references to the extant literature; 
(b) be housed on GitHub, with contributions from all authors obvious;
(c) demonstrate moving data from its raw “messy” format to a tidy data format
through the R Markdown file, but not in the final document;
(d) include at least two exploratory data visualizations, and
(e) include at least summary statistics of the data in tables, although fitted
models of any sort are an added bonus (not literally, there are not extra points
for fitting a model).

## The points for the final project are broken down as follows: 
### Writing (abstract, intro, methods, results, discussion, references)

* 30 points(25%) Document is fully reproducible and housed on GitHub 
* 25 points (21%) Demonstrate use of inline code 
* 5 points (4%) Demonstrate tidying messy data 
* 30 points (25%) Two data visualizations 
* 20 points(10 points each) (17%) Production of at least one table (of summary
  statistics or model results)
* 10 points (8%)


