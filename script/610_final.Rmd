---
title             : "EDLD 610_final"
shorttitle        : "Happiness"

author: 
  - name          : "Asha"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"
  - name          : "Joanna"
    affiliation   : "1"
    corresponding : no    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"
  - name          : "Thuy"
    affiliation   : "1"
    corresponding : no    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"

affiliation:
  - id            : "1"
    institution   : "University of Oregon"

authornote: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

  Enter author note here.

abstract: |
  abstract goes here
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
library("papaja")
library(tidyverse)
library(rio)
library(here)
library(janitor)
library(dplyr)
library(kableExtra)

```

```{r loading the data}

data <- import(here("data","F00007762-WV6_Data_R_v20180912.rds")) %>%
  janitor::clean_names() %>%
  select("v10", "v11", "v24", "v25", "v57", "v147", "v237", "v240") %>% 
  characterize()

```

```{r renaming variable names}

data <- data %>%
  as_tibble() %>%
    rename(
      feeling_of_happiness = v10, 
      state_of_health = v11, 
      most_people_trusted = v24,
      member_religion = v25,
      marital_status = v57,
      religious_person = v147,
      family_savings = v237,
      gender = v240)

```


```{r cleaning the data: recoding levels}

unique(data$feeling_of_happiness)

data_1 <- data %>%
    mutate(feeling_of_happiness = fct_recode(feeling_of_happiness,
                          "Very happy" = "Very happy",
                          "Rather happy" = "Rather happy",
                          "Not very happy" = "Not very happy",
                          "Not at all happy" = "Not at all happy",
                          "Other" = "No answer",
                          "Other" = "Dont know", 
                          "Other" = "HT: Missing-Dropped out survey; RU: Inappropriate response{Inappropriate}"))

data_1 <- data_1 %>%
  mutate(state_of_health = fct_recode(state_of_health,
                          "Very good" = "Very good",
                          "Good" = "Good",
                          "Fair" = "Fair",
                          "Poor" = "Poor",
                          "Other" = "No answer",
                          "Other" = "Dont know", 
                          "Other" = "BH:Missing;HT:Missing-Dropped out survey; RU:Inappropriate response{Inappropriate}")) 
  
data_1 <- data_1 %>%
  mutate(most_people_trusted = fct_recode(most_people_trusted, 
                          "Most people can be trusted" = "Most people can be trusted",
                          "Need to be very careful" = "Need to be very careful",
                          "Other" = "DE,SE: Inapplicable;RU: Inappropiate response;SG:Missing;HT: Dropped out survey{Inappropriate}",
                          "Other" = "No answer",
                          "Other" = "Dont know"))

data_1 <- data_1 %>%
  mutate(member_religion = fct_recode(member_religion, 
                        "Not a member" = "Not a member",
                        "Inactive member" = "Inactive member",
                        "Active member" = "Active member",
                        "Other" =  "HT: Dropped out survey;SE: Inapplicable;RU: Inappropriate response{Inappropriate}",
                        "Other" = "No answer",
                        "Other" = "Dont know"))

data_1 <- data_1 %>%
  mutate(marital_status = fct_recode(marital_status, 
                          "Married" = "Married",
                          "Living together as married" = "Living together as married",
                          "Divorced" = "Divorced",
                          "Separated" = "Separated",
                          "Widowed" = "Widowed",
                          "Single" = "Single",
                          "Other" = "HT: Dropped out survey;SG: Missing; RU: Inappropriate response{Inappropriate}",
                          "Other" = "No answer",
                          "Other" = "Dont know"))

data_1 <- data_1 %>%
  mutate(religious_person = fct_recode(religious_person, 
                           "A religious person" = "A religious person",
                           "Not a religious person" = "Not a religious person",
                           "Not a religious person" = "An atheist",
                           "Other" = "No answer",
                           "Other" = "Dont know",
                           "Other" = "Not asked in survey",
                           "Other" = "DE,SE:Inapplicable ; RU:Inappropriate response; HT: Dropped out survey{Inappropriate}"))

data_1 <- data_1 %>%
mutate(family_savings = fct_recode(family_savings, 
                           "Save money" = "Save money", 
                           "Just get by" = "Just get by", 
                           "Spent savings and borrowed money" = "Spent savings and borrowed money",
                           "Spent some savings and borrowed money" = "Spent some savings and borrowed money",
                           "Other" = "No answer",
                           "Other" = "Dont know", 
                           "Other" = "DE,SE:Inapplicable ; RU:Inappropriate response; BH: Missing; HT: Dropped out survey{Inappropriate}", 
                           "Other" = "Not applicable"))

data_1 <- data_1 %>%
  mutate(gender = fct_recode(gender,
                           "Male" = "Male", 
                           "Female" = "Female", 
                           "Other" = "No answer", 
                           "Other" = "Missing; Unknown"))

# unique(data_1$gender)
# unique(data_1$feeling_of_happiness)
# unique(data_1$marital_status)
# unique(data_1$state_of_health)

```


```{r filtering out observations with "other"}

clean_data <- data_1 %>%
  filter(feeling_of_happiness != "Other" &
           state_of_health != "Other" &
           most_people_trusted != "Other" &
           marital_status != "Other" &
           member_religion != "Other" &
           religious_person != "Other" &
           family_savings != "Other" &
           gender != "Other")

# unique(data_2$feeling_of_happiness)
# unique(data_2$marital_status)
# unique(data_2$most_people_trusted)

```


```{r happiness and family savings JW}

# further tidying the data to use a subset: 

subset_JW <- clean_data %>%
  select(family_savings, feeling_of_happiness)

happiness_by_family_savings <- clean_data %>%
  group_by(family_savings) %>%
  count(feeling_of_happiness)

# making a table: 

kable(happiness_by_family_savings)

# exploring the data with visualizations:

happiness_by_family_savings %>%
  ggplot(aes(feeling_of_happiness, n)) +
  geom_col(fill = "dark blue") +
  facet_wrap(~family_savings) +
  labs(title = "Figure 1", 
       subtitle = "Happiness levels by family savings: Raw numbers",
       x = "Level of happiness",
       y = "Number of people") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# to chart by percentages: 

happiness_by_family_savings <- happiness_by_family_savings %>%
  mutate(total = sum(n)) %>%
  mutate(percent = n/total)

happiness_by_family_savings %>%
  group_by(family_savings) %>%
ggplot(aes(feeling_of_happiness, percent)) +
  geom_col(fill = "dark blue") +
  facet_wrap(~family_savings) +
  labs(title = "Figure 2", 
       subtitle = "Happiness levels by family savings: percentage",
       x = "Level of happiness",
       y = "Percentage of total") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))


# it would be interesting to look at these percentages in order  to compare happiness levels amongst groups:     

happiness_by_family_savings %>%
  as_tibble() %>%
  arrange(percent)

# or, another way to visualize this would be: 

happiness_by_family_savings %>%
  ggplot(aes(feeling_of_happiness, percent, colour = family_savings)) +
  geom_point() +
  geom_smooth(se = FALSE, method = lm) +
  labs(Title = "Figure 3",
       subtitle = "Amother way of looking at happiness by family savings: percentage")
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

?geom_smooth

```

As Figure 3 shows, although patterns of happiness levels are similar overall (e.g. most people report being "Rather Happy", fewest people report being "Not happy at all"), there are some differences of happiness level distributions between groups. A greater percentage of those with the lowest level of family savings (those who spent savings and borrowed money) reported being "Not at all happy" or "Not very happy". On the other hand, the greatest percentage of people reporting being "Rather happy" were those who reported just getting by, and the greatest percentage of people reporting the highest level of happiness were those in the strongest financial position - those who saved money.

(NOTE: I'd like to use inline code here to reference exact percentages. How do put one cell value into inline code??)



```{r trying out pivot_wider and pivot_longer}

happiness_by_family_savings_1 <- happiness_by_family_savings%>%
  pivot_wider(
    names_from = family_savings,
    values_from = percent)

happiness_by_family_savings_2 <- happiness_by_family_savings_1 %>%
  pivot_longer(
    cols = c("Save money", "Just get by", "Spent some savings and borrowed money", "Spent savings and borrowed money"), 
    names_to = "family_savings",
    values_to = "percent"
  )

?pivot_longer

```



# Methods
We report how we determined our sample size, all data exclusions (if any), all manipulations, and all measures in the study. <!-- 21-word solution (Simmons, Nelson & Simonsohn, 2012; retrieved from http://ssrn.com/abstract=2160588) -->

## Participants

## Material

## Procedure

## Data analysis
We used `r cite_r("r-references.bib")` for all our analyses.


# Results

# Discussion


\newpage

# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup

Final Paper

The final project must:

(a) be a reproducible and dynamic APA manuscript produced with R Markdown, via
the {papaja} package and include references to the extant literature; 
(b) be housed on GitHub, with contributions from all authors obvious;
(c) demonstrate moving data from its raw “messy” format to a tidy data format
through the R Markdown file, but not in the final document;
(d) include at least two exploratory data visualizations, and
(e) include at least summary statistics of the data in tables, although fitted
models of any sort are an added bonus (not literally, there are not extra points
for fitting a model).

## The points for the final project are broken down as follows: 
### Writing (abstract, intro, methods, results, discussion, references)

* 30 points(25%) Document is fully reproducible and housed on GitHub 
* 25 points (21%) Demonstrate use of inline code 
* 5 points (4%) Demonstrate tidying messy data 
* 30 points (25%) Two data visualizations 
* 20 points(10 points each) (17%) Production of at least one table (of summary
  statistics or model results)
* 10 points (8%)


